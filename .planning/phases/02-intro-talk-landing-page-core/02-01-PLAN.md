---
phase: 02-intro-talk-landing-page-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/app/(main)/layout.tsx
  - src/app/(main)/page.tsx
  - src/app/(main)/privacy-policy/page.tsx
  - src/app/(landing)/layout.tsx
  - src/lib/schemas/registration.ts
  - src/actions/register.ts
  - src/lib/data/intro-talks.ts
  - package.json
autonomous: true
requirements: [INTRO-03, INTRO-09]

must_haves:
  truths:
    - "Existing homepage and privacy policy pages still render correctly after route group migration"
    - "Landing pages have no site header or footer navigation"
    - "Registration schema validates name (required), email (required, valid format), phone (optional), and consent (must be true)"
    - "Server Action accepts FormData and returns structured success/error response"
  artifacts:
    - path: "src/app/(main)/layout.tsx"
      provides: "Standard page layout with site header and footer"
      contains: "SiteHeader"
    - path: "src/app/(landing)/layout.tsx"
      provides: "Minimal landing page layout without navigation"
      min_lines: 5
    - path: "src/lib/schemas/registration.ts"
      provides: "Zod validation schema shared between client and server"
      exports: ["registrationSchema", "RegistrationInput"]
    - path: "src/actions/register.ts"
      provides: "Server Action for form submission"
      exports: ["registerForIntroTalk"]
    - path: "src/lib/data/intro-talks.ts"
      provides: "Hardcoded intro talk session data"
      exports: ["nextIntroTalk"]
  key_links:
    - from: "src/actions/register.ts"
      to: "src/lib/schemas/registration.ts"
      via: "imports registrationSchema for server-side validation"
      pattern: "import.*registrationSchema.*from.*schemas/registration"
---

<objective>
Set up route group architecture and form infrastructure for the intro talk landing page.

Purpose: Create the foundational route groups so landing pages have no navigation distractions, install form dependencies, and build the registration schema + server action that the page components will use.

Output: Route groups `(main)` and `(landing)` working with existing pages migrated, plus registration schema, server action, and intro talk data file ready for Plan 02.
</objective>

<execution_context>
@/Users/mac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-intro-talk-landing-page-core/02-RESEARCH.md
@.planning/phases/01-project-scaffolding-deploy/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, add shadcn/ui components, and create route groups</name>
  <files>
    package.json
    src/app/layout.tsx
    src/app/(main)/layout.tsx
    src/app/(main)/page.tsx
    src/app/(main)/privacy-policy/page.tsx
    src/app/(landing)/layout.tsx
  </files>
  <action>
Step 1: Install form dependencies:
```bash
npm install react-hook-form zod @hookform/resolvers
```

Step 2: Add shadcn/ui components needed for the landing page:
```bash
npx shadcn@latest add button input checkbox label card badge separator
```
(Some may already exist — that's fine, the CLI handles it.)

Step 3: Create route group structure. This is a careful migration per the research Pitfall 1:

3a. Create `src/app/(main)/layout.tsx` — this wraps children with SiteHeader + SiteFooter:
```tsx
import { SiteHeader } from "@/components/layout/site-header"
import { SiteFooter } from "@/components/layout/site-footer"

export default function MainLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex min-h-screen flex-col">
      <SiteHeader />
      <main className="flex-1">{children}</main>
      <SiteFooter />
    </div>
  )
}
```

3b. Move `src/app/page.tsx` → `src/app/(main)/page.tsx` (content unchanged)
3c. Move `src/app/privacy-policy/page.tsx` → `src/app/(main)/privacy-policy/page.tsx` (content unchanged)

3d. Update `src/app/layout.tsx` (root layout) — REMOVE SiteHeader/SiteFooter imports and rendering. Keep ONLY html/body shell with Inter font, globals.css import, metadata, and viewport. Remove the `flex flex-col` from body since each group layout handles its own flex. The root layout becomes:
```tsx
import type { Metadata, Viewport } from "next"
import { Inter } from "next/font/google"
import "./globals.css"

const inter = Inter({ variable: "--font-inter", subsets: ["latin"], display: "swap" })

export const metadata: Metadata = {
  title: {
    default: "Art of Living Devon & Southwest",
    template: "%s | Art of Living Devon & Southwest",
  },
  description: "Free intro talks and meditation courses in Devon and Southwest England...",
}

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  themeColor: "#F97316",
}

export default function RootLayout({ children }: Readonly<{ children: React.ReactNode }>) {
  return (
    <html lang="en">
      <body className={`${inter.variable} font-sans min-h-screen antialiased`}>
        {children}
      </body>
    </html>
  )
}
```

3e. Create `src/app/(landing)/layout.tsx` — minimal layout, no header/footer:
```tsx
export default function LandingLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen">
      {children}
    </div>
  )
}
```

Step 4: Verify the migration by running `npm run build`. Both `/` and `/privacy-policy` must still build without errors.

IMPORTANT: Do NOT delete the original files until the new route group files are confirmed working. Move (copy then delete) to avoid data loss.
  </action>
  <verify>
    <automated>cd "/Users/mac/Documents/Art of Living Landing Page" && npm run build 2>&1 | tail -20</automated>
    <manual>Check that src/app/(main)/page.tsx and src/app/(main)/privacy-policy/page.tsx exist. Check that src/app/page.tsx (at root, outside route groups) does NOT exist. Check that src/app/layout.tsx no longer imports SiteHeader/SiteFooter.</manual>
  </verify>
  <done>Route groups (main) and (landing) exist. Existing pages migrated to (main) with header/footer. Landing layout has no navigation. `npm run build` succeeds with zero errors.</done>
</task>

<task type="auto">
  <name>Task 2: Create registration schema, server action, and intro talk data</name>
  <files>
    src/lib/schemas/registration.ts
    src/actions/register.ts
    src/lib/data/intro-talks.ts
  </files>
  <action>
Step 1: Create `src/lib/schemas/registration.ts` with the shared Zod schema:
- `name`: string, min 1 ("Please enter your name"), max 100
- `email`: string, min 1 ("Please enter your email"), email format ("Please enter a valid email address")
- `phone`: string, max 20, optional, or empty string (z.literal(""))
- `consent`: z.literal(true) with custom error "You must agree to receive event communications"
- Export the schema AND the inferred type `RegistrationInput`

Step 2: Create `src/actions/register.ts` as a Server Action ("use server"):
- Import registrationSchema from `@/lib/schemas/registration`
- Define and export `RegistrationState` type: `{ success: boolean; message: string; errors?: Record<string, string[]> }`
- Export `registerForIntroTalk(prevState: RegistrationState, formData: FormData): Promise<RegistrationState>`
- Parse FormData: name = formData.get("name"), email = formData.get("email"), phone = formData.get("phone") || "", consent = formData.get("consent") === "on" (HTML checkbox returns "on" when checked, see research Pitfall 6)
- Validate with registrationSchema.safeParse()
- On failure: return `{ success: false, message: "Please check the form for errors.", errors: result.error.flatten().fieldErrors }`
- On success: `console.log("New registration:", result.data)` and return `{ success: true, message: "You're registered! We'll send you the Zoom details by email." }`
- Note: Actual Brevo integration deferred to Phase 9

Step 3: Create `src/lib/data/intro-talks.ts`:
- Export a `nextIntroTalk` object with: `{ title: "Free Intro to the Art of Living", date: "Saturday 8 March 2025", time: "10:00 AM", timezone: "GMT", location: "Online via Zoom", duration: "60 minutes" }`
- Export type `IntroTalkSession`
- This is a simple data file, not a CMS — just typed constants that can be updated easily. Prepares for Phase 4 multi-session support.
  </action>
  <verify>
    <automated>cd "/Users/mac/Documents/Art of Living Landing Page" && npx tsc --noEmit 2>&1 | tail -20</automated>
    <manual>Verify src/lib/schemas/registration.ts exports registrationSchema and RegistrationInput. Verify src/actions/register.ts starts with "use server" and exports registerForIntroTalk. Verify src/lib/data/intro-talks.ts exports nextIntroTalk.</manual>
  </verify>
  <done>Registration schema validates all 4 fields with proper error messages. Server Action accepts FormData, re-validates server-side, and returns structured response. Intro talk data file provides typed session constants. TypeScript compiles with no errors.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. `npx tsc --noEmit` passes — all TypeScript types resolve
3. Route `/` still works (serves homepage from (main) group)
4. Route `/privacy-policy` still works (serves privacy policy from (main) group)
5. No SiteHeader/SiteFooter imports in root layout.tsx
6. `(landing)/layout.tsx` has no header or footer components
</verification>

<success_criteria>
- Route group architecture is in place with (main) and (landing) separation
- All Phase 1 pages still build and render correctly
- Registration form infrastructure (schema + server action + data) is ready for Plan 02 to consume
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-intro-talk-landing-page-core/02-01-SUMMARY.md`
</output>
