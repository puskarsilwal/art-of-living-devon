---
phase: 07-event-pages
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/data/events/index.ts
  - src/actions/event-optin.ts
autonomous: true
requirements:
  - EVENT-01
  - EVENT-02
  - EVENT-03

must_haves:
  truths:
    - "EventConfig type captures all required fields: slug, title, date, time, location, price, registrationUrl, heroImage"
    - "getAllEvents() returns all events; getEventBySlug(slug) returns one event or undefined"
    - "Email opt-in stub action returns success state without throwing; GDPR field included in schema"
    - "Sample Satsang event entry demonstrates all required fields for EVENT-02"
  artifacts:
    - path: "src/lib/data/events/index.ts"
      provides: "EventConfig type, events array, getAllEvents(), getEventBySlug() helpers"
      exports: ["EventConfig", "EventTestimonial", "events", "getAllEvents", "getEventBySlug"]
    - path: "src/actions/event-optin.ts"
      provides: "Stub server action for email opt-in form; Phase 9 Brevo slot reserved"
      exports: ["subscribeToEventUpdates", "OptinState"]
  key_links:
    - from: "src/lib/data/events/index.ts"
      to: "src/components/events/*.tsx"
      via: "EventConfig type import"
      pattern: "import.*EventConfig.*from.*@/lib/data/events"
    - from: "src/actions/event-optin.ts"
      to: "src/components/events/event-email-optin.tsx"
      via: "useActionState binding"
      pattern: "subscribeToEventUpdates"
---

<objective>
Create the EventConfig data module and email opt-in stub server action that drive the entire event page template system.

Purpose: Every event page section component imports EventConfig from this module. The data module + stub action are pure foundations with no UI dependencies — they should be built in Wave 1 before any component work begins.
Output: `src/lib/data/events/index.ts` with EventConfig type + sample Satsang event, and `src/actions/event-optin.ts` with stub server action.
</objective>

<execution_context>
@/Users/mac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-event-pages/07-CONTEXT.md
@.planning/phases/07-event-pages/07-RESEARCH.md

# Existing data module patterns to follow
@src/lib/data/intro-talks.ts
@src/lib/data/course-dates.ts
@src/lib/data/testimonials.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: EventConfig data module with sample Satsang event</name>
  <files>src/lib/data/events/index.ts</files>
  <action>
Create `src/lib/data/events/index.ts` following the exact pattern of `src/lib/data/intro-talks.ts` and `src/lib/data/course-dates.ts`.

Define and export:

```typescript
export type EventConfig = {
  slug: string
  title: string
  subtitle?: string
  eventType: "satsang" | "kirtan" | "community" | "special"
  date: string             // "Saturday 15 March 2026"
  dateISO: string          // ISO 8601: "2026-03-15T19:00:00Z"
  time: string             // "7:00 PM"
  timezone: string         // "GMT" | "BST"
  duration: string         // "2 hours"
  location: string
  locationMapUrl?: string  // Google Maps URL
  description: string      // Short marketing description (1-2 sentences)
  longDescription?: string
  price: string | null     // "£8" | "Free" | null means "contact us"
  registrationUrl: string  // External link — NOT a Next.js route
  heroImage: string
  videoUrl?: string        // youtube-nocookie.com embed URL (no autoplay)
  testimonials?: EventTestimonial[]
  brevoListId?: number     // Reserved for Phase 9 — leave undefined in Phase 7
  seoTitle?: string
  seoDescription?: string
  robots?: { index: boolean; follow: boolean }
}

export type EventTestimonial = {
  name: string
  quote: string
  highlight?: string
}
```

Create one sample Satsang event in the `events` array:
- slug: "satsang-2026-march"
- title: "Satsang Evening"
- subtitle: "Meditation, chanting, and collective silence"
- eventType: "satsang"
- date: "Saturday 15 March 2026"
- dateISO: "2026-03-15T19:00:00Z"
- time: "7:00 PM"
- timezone: "GMT"
- duration: "2 hours"
- location: "Exeter, Devon"
- description: "An evening of guided meditation, kirtan chanting, and deep silence with the Art of Living Devon community."
- price: "Free — donations welcome"
- registrationUrl: "https://www.artofliving.org/gb-en/events" (with TODO comment: "PLACEHOLDER — replace with real event URL before go-live")
- heroImage: "/images/events/satsang-hero.jpg" (stock placeholder — see Task 2 in plan 02 for image sourcing)
- Include 2-3 testimonials in the `testimonials` array using realistic Art of Living participant language (e.g. "The chanting completely transported me — I left feeling lighter than I have in months." — Sarah, Exeter)

Export helpers:
```typescript
export function getEventBySlug(slug: string): EventConfig | undefined {
  return events.find((e) => e.slug === slug)
}

export function getAllEvents(): EventConfig[] {
  return events
}
```

Follow OKLCH/TypeScript conventions established in the project. No `any` types.
  </action>
  <verify>
    <automated>cd "/Users/mac/Documents/Art of Living Landing Page" && npx tsc --noEmit 2>&1 | grep -E "events/index|OptinState|EventConfig" || echo "No type errors in events module"</automated>
    <manual>Confirm EventConfig type has all EVENT-02 required fields: date, time, location, description, price</manual>
  </verify>
  <done>src/lib/data/events/index.ts exists with EventConfig type, EventTestimonial type, events array with 1 Satsang entry, getAllEvents() and getEventBySlug() exported</done>
</task>

<task type="auto">
  <name>Task 2: Email opt-in stub server action</name>
  <files>src/actions/event-optin.ts</files>
  <action>
Create `src/actions/event-optin.ts` following the exact pattern of the intro talk registration server action.

```typescript
"use server"

import { z } from "zod"

export type OptinState = {
  success: boolean
  message: string
  errors?: {
    name?: string[]
    email?: string[]
    consent?: string[]
  }
}

const optinSchema = z.object({
  name: z.string().min(1, "Please enter your name"),
  email: z.string().email("Please enter a valid email address"),
  consent: z.literal("on", { message: "Please tick the consent checkbox to continue" }),
})

export async function subscribeToEventUpdates(
  _prev: OptinState,
  formData: FormData
): Promise<OptinState> {
  const result = optinSchema.safeParse({
    name: formData.get("name"),
    email: formData.get("email"),
    consent: formData.get("consent"),
  })

  if (!result.success) {
    return {
      success: false,
      message: "Please check the fields below.",
      errors: result.error.flatten().fieldErrors,
    }
  }

  // TODO Phase 9: Wire to Brevo API with per-event brevoListId
  console.log("[Phase 7 stub] Event opt-in:", {
    name: result.data.name,
    email: result.data.email,
  })

  return {
    success: true,
    message: "You're on the list! We'll send event updates to your inbox.",
  }
}
```

Use Zod v4 pattern: `z.literal("on", { message: "..." })` for consent field (matches existing project usage — NOT errorMap which is Zod v3).
  </action>
  <verify>
    <automated>cd "/Users/mac/Documents/Art of Living Landing Page" && npx tsc --noEmit 2>&1 | grep -E "event-optin|OptinState" || echo "No type errors in event-optin action"</automated>
  </verify>
  <done>src/actions/event-optin.ts exports subscribeToEventUpdates and OptinState; "use server" directive at top; Zod v4 schema validates name, email, and consent fields</done>
</task>

</tasks>

<verification>
Run `cd "/Users/mac/Documents/Art of Living Landing Page" && npx tsc --noEmit` — zero TypeScript errors in the two new files.
</verification>

<success_criteria>
- EventConfig type covers all EVENT-02 display fields (date, time, location, description, price)
- getEventBySlug() and getAllEvents() exported and typed correctly
- subscribeToEventUpdates stub server action validates name + email + GDPR consent and returns OptinState
- No new npm packages installed (all libraries already in project)
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-event-pages/07-01-SUMMARY.md`
</output>
